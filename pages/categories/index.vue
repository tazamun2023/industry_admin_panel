<template>
  <list-page
    ref="listPage"
    list-api="getCategories"
    delete-api="deleteCategory"
    route-name="categories"
    empty-store-variable="allCategories"
    :name="$t('category.cat')"
    gate="manage_categories"
    manage_gate="manage_categories"

    :order-options="orderOptions"
    class="tree-wrapper"
    @delete-bulk="deleteBulk"
    @list="setCategories"
  >
    <template
      v-slot:table="{list}"
    >

      <ul class="table-tree">
        <tree-node
          v-for="value in list"
          :node="value"
          :key="value.id"
          @edit="editNode"
          @delete="deleteNode"
        >
          <template
            v-slot:checkbox="{id}"
          >
            <input type="checkbox" :value="id" v-model="cbList">
          </template>

          <template
            v-slot:inner-checkbox="{id}"
          >
            <input type="checkbox" :value="id" v-model="cbList">
          </template>

        </tree-node>
      </ul>

    </template>
  </list-page>
</template>

<script>

import ListPage from "~/components/partials/ListPage"
import util from '~/mixin/util'
import LazyImage from "~/components/LazyImage"
import TreeNode from "~/components/TreeNode"
import {mapActions} from "vuex";

export default {
  name: "categories",
  middleware: ['common-middleware', 'auth'],
  data() {
    return {
      cbList: [],
      orderOptions: {
        created_at: {title: this.$t('category.date')},
        title: {title: this.$t('index.title')},
        status: {title: this.$t('category.status')}
      }
    }
  },
  components: {
    TreeNode,
    LazyImage,
    ListPage
  },
  mixins: [util],
  computed: {},
  methods: {
    ...mapActions('common', ['setCategoriesTree']),
    setCategories(result) {
      this.setCategoriesTree(result);
    },
    deleteBulk() {


      if (this.cbList?.length) {
        this.$refs.listPage.deleteItem(this.cbList.join(','))
      }
    },

    editNode(node) {
      this.$refs.listPage.editItem(node.id)
    },
    deleteNode(node) {
      this.$refs.listPage.deleteItem(node.id)
    }
  },
  mounted() {
  }
}
</script>

<style scoped>

</style>
